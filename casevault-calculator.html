<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Injury Settlement Calculator | CaseVault by AIBridges</title>
    <meta name="description" content="Free PI settlement calculator using real settlement data from New England courts. Get instant estimates based on actual case outcomes.">
    <link rel="canonical" href="https://aibridges.org/casevault-calculator">
    <link rel="stylesheet" href="css/style.css">
    <!-- Load settlement data from S3 -->
    <script src="https://engagement-hooks-site.s3.amazonaws.com/casevault/data/settlements.js"></script>
    <script>
        // Auth check - redirect to intake if not authenticated
        (function() {
            const token = localStorage.getItem('casevault_token');
            const expires = localStorage.getItem('casevault_expires');
            if (!token || !expires || Date.now() >= parseInt(expires)) {
                window.location.href = 'casevault-intake.html';
            }
        })();
        
        // ===== Anti-Scraping Protections =====
        (function() {
            // 1. Bot/headless detection
            const isBot = navigator.webdriver || 
                window.__nightmare || 
                window.phantom ||
                window._phantom ||
                /HeadlessChrome|PhantomJS/.test(navigator.userAgent) ||
                !navigator.languages || navigator.languages.length === 0;
            
            if (isBot) {
                document.body.innerHTML = '<h1 style="text-align:center;margin-top:200px;font-family:sans-serif">Access Denied</h1>';
                throw new Error('Automated access blocked');
            }

            // 2. Rate limiting (30 loads/hour)
            const now = Date.now();
            const hourAgo = now - 3600000;
            let loads = JSON.parse(localStorage.getItem('_cv_loads') || '[]').filter(t => t > hourAgo);
            if (loads.length >= 30) {
                alert('Rate limit exceeded. Please try again later.');
                window.location.href = 'https://aibridges.org';
                return;
            }
            loads.push(now);
            localStorage.setItem('_cv_loads', JSON.stringify(loads));

            // 3. Console warning
            console.log('%c‚ö†Ô∏è WARNING', 'color: red; font-size: 24px; font-weight: bold;');
            console.log('%cScraping this data is prohibited. All access is logged and monitored.', 'color: red; font-size: 14px;');
            console.log('%cData is proprietary and protected by copyright.', 'color: orange;');

            // 4. Disable right-click on data elements
            document.addEventListener('contextmenu', function(e) {
                if (e.target.closest('#results, .settlement-data, table')) {
                    e.preventDefault();
                    return false;
                }
            });

            // 5. DevTools detection
            let devtools = false;
            const threshold = 160;
            setInterval(() => {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools) {
                        devtools = true;
                        console.clear();
                        console.log('%cüîí Developer tools detected. Data access logged.', 'color: red; font-size: 16px;');
                    }
                }
            }, 1000);
        })();
    </script>
    <style>
        .casevault-hero {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 80px 20px;
            text-align: center;
        }
        .casevault-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .casevault-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        .calculator-container {
            max-width: 800px;
            margin: -60px auto 60px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 40px;
        }
        .form-group {
            margin-bottom: 24px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #8E44AD;
        }
        .btn-primary {
            background: linear-gradient(135deg, #8E44AD 0%, #06b6d4 100%);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .result-box {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: #f0f9ff;
            border-left: 4px solid #8E44AD;
            border-radius: 8px;
        }
        .result-box.show {
            display: block;
        }
        .result-value {
            font-size: 32px;
            font-weight: 700;
            color: #8E44AD;
            margin: 10px 0;
        }
        .confidence-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .confidence-high { background: #dcfce7; color: #166534; }
        .confidence-medium { background: #fef3c7; color: #92400e; }
        .confidence-low { background: #fee2e2; color: #991b1b; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #8E44AD;
        }
        .stat-label {
            color: #64748b;
            font-size: 0.9rem;
            margin-top: 4px;
        }
        .notice-banner {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .range-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .range-item {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }
        .range-item-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
        }
        .range-item-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
        }
        .range-item-value.highlight {
            font-size: 2rem;
            color: #8E44AD;
        }
    </style>
</head>
<body>
    <!-- Include site header -->
    <header class="header">
        <div class="container">
            <a href="/" class="logo">AIBridges</a>
            <nav>
                <a href="/">Home</a>
                <a href="/blog.html">Blog</a>
                <a href="/contact.html">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="casevault-hero">
        <h1>üèõÔ∏è Settlement Calculator</h1>
        <p>
            Estimate your personal injury settlement based on real case data from MA, CT, RI & NH
        </p>
    </section>

    <!-- Stats Grid -->
    <div style="max-width: 800px; margin: -30px auto 0; padding: 0 20px;">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalCasesDisplay">--</div>
                <div class="stat-label">Total Cases</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">4</div>
                <div class="stat-label">States Covered</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">2024-26</div>
                <div class="stat-label">Data Range</div>
            </div>
        </div>
    </div>

    <!-- Calculator Form -->
    <div class="calculator-container">
        <div id="noticeBanner" class="notice-banner" style="display: none;">
            ‚ö†Ô∏è We're currently collecting settlement data. Estimates may be limited until more cases are added.
        </div>
        
        <form id="calculatorForm">
            <div class="form-group">
                <label for="state">State *</label>
                <select id="state" required>
                    <option value="MA">Massachusetts</option>
                    <option value="CT">Connecticut</option>
                    <option value="RI">Rhode Island</option>
                    <option value="NH">New Hampshire</option>
                </select>
            </div>

            <div class="form-group">
                <label for="caseType">Case Type *</label>
                <select id="caseType" required>
                    <option value="">Select case type...</option>
                    <option value="rear_end">Rear-End Collision</option>
                    <option value="t_bone">T-Bone / Intersection</option>
                    <option value="truck">Truck Accident</option>
                    <option value="motorcycle">Motorcycle Accident</option>
                    <option value="pedestrian">Pedestrian Hit</option>
                    <option value="slip_and_fall">Slip and Fall</option>
                    <option value="auto_accident">Other Auto Accident</option>
                </select>
            </div>

            <div class="form-group">
                <label for="injuryType">Injury Severity *</label>
                <select id="injuryType" required>
                    <option value="">Select injury type...</option>
                    <option value="soft_tissue">Soft Tissue (whiplash, sprains)</option>
                    <option value="fracture">Fracture</option>
                    <option value="surgery_required">Surgery Required</option>
                    <option value="tbi">Traumatic Brain Injury</option>
                    <option value="spinal">Spinal Cord Injury</option>
                    <option value="wrongful_death">Wrongful Death</option>
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="medicalCosts">Medical Costs ($)</label>
                    <input type="number" id="medicalCosts" placeholder="e.g., 25000">
                </div>
                <div class="form-group">
                    <label for="lostWages">Lost Wages ($)</label>
                    <input type="number" id="lostWages" placeholder="e.g., 15000">
                </div>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="wentToLitigation" style="width: auto;">
                    Filed lawsuit (litigation) ‚Äî typically increases value 40-60%
                </label>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="hadExpertWitness" style="width: auto;">
                    Had expert witness ‚Äî typically increases value 80-130%
                </label>
            </div>

            <button type="submit" class="btn-primary" id="submitBtn">
                Get Settlement Estimate
            </button>
        </form>

        <!-- Results -->
        <div id="resultBox" class="result-box">
            <span id="confidenceBadge" class="confidence-badge confidence-medium">MEDIUM Confidence</span>
            <h3 style="margin: 0 0 10px; color: #1e293b;">Estimated Settlement Range</h3>
            
            <div class="range-display">
                <div class="range-item">
                    <div class="range-item-label">Conservative</div>
                    <div class="range-item-value" id="lowEstimate">--</div>
                </div>
                <div class="range-item">
                    <div class="range-item-label">Median</div>
                    <div class="range-item-value highlight" id="midEstimate">--</div>
                </div>
                <div class="range-item">
                    <div class="range-item-label">Aggressive</div>
                    <div class="range-item-value" id="highEstimate">--</div>
                </div>
            </div>
            
            <p id="resultNote" style="color: #64748b; font-size: 14px; margin-top: 15px;"></p>
        </div>

        <!-- CTA -->
        <div style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 8px; text-align: center;">
            <h4 style="margin: 0 0 10px;">üìä Want a detailed case analysis?</h4>
            <p style="color: #64748b; font-size: 14px; margin-bottom: 15px;">
                Get personalized insights and comparable cases from your area.
            </p>
            <a href="/contact.html" class="btn-primary" style="display: inline-block; width: auto; padding: 12px 24px; font-size: 16px; text-decoration: none;">
                Request Free Consultation
            </a>
        </div>
    </div>

    <!-- Footer -->
    <footer style="text-align: center; padding: 40px 20px; color: #64748b; font-size: 14px;">
        <p>Estimates based on real settlement data. Not legal advice.</p>
        <p>¬© 2026 <a href="/" style="color: #8E44AD;">AIBridges</a> | Cranston, RI</p>
    </footer>

    <script>
        // Data loaded from S3 -> window.CASEVAULT_DATA
        const DATA = window.CASEVAULT_DATA || null;

        // Update stats display
        document.addEventListener('DOMContentLoaded', function() {
            if (DATA && DATA.totalSettlements > 0) {
                document.getElementById('totalCasesDisplay').textContent = DATA.totalSettlements.toLocaleString();
            } else {
                document.getElementById('totalCasesDisplay').textContent = '0';
                document.getElementById('noticeBanner').style.display = 'block';
            }
        });

        function formatCurrency(num) {
            if (num >= 1000000) {
                return '$' + (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return '$' + Math.round(num / 1000) + 'K';
            }
            return '$' + num.toLocaleString();
        }

        function calculateEstimate(params) {
            const { state, caseType, injuryType, medicalCosts, lostWages, wentToLitigation, hadExpertWitness } = params;
            
            // If we have real data, use it
            if (DATA && DATA.totalSettlements > 0) {
                const stateData = DATA.states[state];
                
                if (stateData && stateData.sampleSize > 0) {
                    const injuryData = stateData.byInjuryType?.[injuryType];
                    const caseTypeData = stateData.byCaseType?.[caseType];
                    
                    let lowEstimate, midEstimate, highEstimate;
                    let confidence = 'MEDIUM';
                    
                    if (injuryData) {
                        lowEstimate = injuryData.range?.[0] || injuryData.typical * 0.5;
                        midEstimate = injuryData.typical;
                        highEstimate = injuryData.range?.[1] || injuryData.typical * 2;
                    } else {
                        // Fall back to state stats
                        lowEstimate = stateData.stats?.p25 || 15000;
                        midEstimate = stateData.stats?.median || 50000;
                        highEstimate = stateData.stats?.p75 || 150000;
                        confidence = 'LOW';
                    }
                    
                    // Adjust for case type
                    if (caseTypeData?.avg && stateData.stats?.median) {
                        const multiplier = caseTypeData.avg / stateData.stats.median;
                        lowEstimate *= multiplier;
                        midEstimate *= multiplier;
                        highEstimate *= multiplier;
                    }
                    
                    // Adjust for litigation
                    if (wentToLitigation) {
                        lowEstimate *= 1.3;
                        midEstimate *= 1.5;
                        highEstimate *= 1.6;
                    }
                    
                    // Adjust for expert witness
                    if (hadExpertWitness) {
                        lowEstimate *= 1.4;
                        midEstimate *= 1.8;
                        highEstimate *= 2.3;
                    }
                    
                    // Factor in economic damages if provided
                    if (medicalCosts > 0 || lostWages > 0) {
                        const economic = (medicalCosts || 0) + (lostWages || 0);
                        // Weight the estimate with economic damages
                        midEstimate = Math.max(midEstimate, economic * 2);
                        lowEstimate = Math.max(lowEstimate, economic * 1.5);
                        highEstimate = Math.max(highEstimate, economic * 4);
                    }
                    
                    if (stateData.sampleSize >= 100) confidence = 'HIGH';
                    else if (stateData.sampleSize >= 50) confidence = 'MEDIUM';
                    else confidence = 'LOW';
                    
                    return {
                        success: true,
                        lowEstimate: Math.round(lowEstimate),
                        midEstimate: Math.round(midEstimate),
                        highEstimate: Math.round(highEstimate),
                        confidence,
                        note: `Based on ${stateData.sampleSize} ${state} settlements`
                    };
                }
            }
            
            // Fallback: formula-based estimate
            const economic = (medicalCosts || 0) + (lostWages || 0);
            let multiplier = 2;
            
            if (injuryType === 'soft_tissue') multiplier = 1.5;
            else if (injuryType === 'fracture') multiplier = 2.5;
            else if (injuryType === 'surgery_required') multiplier = 3.5;
            else if (injuryType === 'tbi') multiplier = 5;
            else if (injuryType === 'spinal') multiplier = 6;
            else if (injuryType === 'wrongful_death') multiplier = 8;
            
            if (wentToLitigation) multiplier *= 1.5;
            if (hadExpertWitness) multiplier *= 1.8;
            
            const base = economic > 0 ? economic : 25000; // Default base if no costs entered
            
            return {
                success: true,
                lowEstimate: Math.round(base * multiplier * 0.6),
                midEstimate: Math.round(base * multiplier),
                highEstimate: Math.round(base * multiplier * 1.8),
                confidence: 'LOW',
                note: 'Estimate based on industry formulas (limited case data available)'
            };
        }

        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const params = {
                state: document.getElementById('state').value,
                caseType: document.getElementById('caseType').value,
                injuryType: document.getElementById('injuryType').value,
                medicalCosts: parseFloat(document.getElementById('medicalCosts').value) || 0,
                lostWages: parseFloat(document.getElementById('lostWages').value) || 0,
                wentToLitigation: document.getElementById('wentToLitigation').checked,
                hadExpertWitness: document.getElementById('hadExpertWitness').checked
            };
            
            const result = calculateEstimate(params);
            
            // Display results
            document.getElementById('lowEstimate').textContent = formatCurrency(result.lowEstimate);
            document.getElementById('midEstimate').textContent = formatCurrency(result.midEstimate);
            document.getElementById('highEstimate').textContent = formatCurrency(result.highEstimate);
            document.getElementById('resultNote').textContent = result.note;
            
            // Confidence badge
            const badge = document.getElementById('confidenceBadge');
            badge.textContent = result.confidence + ' Confidence';
            badge.className = 'confidence-badge confidence-' + result.confidence.toLowerCase();
            
            document.getElementById('resultBox').classList.add('show');
            document.getElementById('resultBox').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        });
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</body>
</html>
