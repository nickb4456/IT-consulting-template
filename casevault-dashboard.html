<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaseVault Dashboard | Settlement Benchmarks</title>
    <meta name="robots" content="noindex, nofollow">
    <script src="https://engagement-hooks-site.s3.amazonaws.com/casevault/data/settlements.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f172a; color: white; min-height: 100vh; }
        
        .nav { background: rgba(15, 23, 42, 0.95); padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #334155; }
        .nav-logo { font-size: 20px; font-weight: 700; color: #818cf8; text-decoration: none; }
        .nav-links { display: flex; gap: 24px; }
        .nav-links a { color: #94a3b8; text-decoration: none; font-size: 14px; }
        .nav-links a:hover, .nav-links a.active { color: white; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
        
        .header { margin-bottom: 32px; }
        .header h1 { font-size: 28px; margin-bottom: 8px; }
        .header p { color: #94a3b8; }
        
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px; }
        .stat-card { background: #1e293b; border-radius: 12px; padding: 20px; border: 1px solid #334155; }
        .stat-value { font-size: 32px; font-weight: 700; color: #818cf8; }
        .stat-label { font-size: 13px; color: #64748b; margin-top: 4px; }
        
        .filters { background: #1e293b; border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 1px solid #334155; }
        .filters h3 { font-size: 14px; color: #94a3b8; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px; }
        .filter-row { display: flex; gap: 16px; flex-wrap: wrap; }
        .filter-group { flex: 1; min-width: 150px; }
        .filter-group label { display: block; font-size: 12px; color: #64748b; margin-bottom: 6px; }
        .filter-group select { width: 100%; padding: 10px 12px; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: white; font-size: 14px; }
        .filter-group select:focus { outline: none; border-color: #818cf8; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
        
        .card { background: #1e293b; border-radius: 12px; padding: 24px; border: 1px solid #334155; }
        .card h3 { font-size: 16px; margin-bottom: 20px; color: #e2e8f0; }
        
        .bar-chart { display: flex; flex-direction: column; gap: 12px; }
        .bar-item { display: flex; align-items: center; gap: 12px; }
        .bar-label { width: 100px; font-size: 13px; color: #94a3b8; flex-shrink: 0; }
        .bar-track { flex: 1; height: 24px; background: #0f172a; border-radius: 6px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #818cf8, #a78bfa); border-radius: 6px; transition: width 0.5s ease; }
        .bar-value { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 12px; font-weight: 600; }
        
        .table { width: 100%; border-collapse: collapse; }
        .table th { text-align: left; padding: 12px; font-size: 12px; color: #64748b; border-bottom: 1px solid #334155; text-transform: uppercase; }
        .table td { padding: 12px; font-size: 14px; border-bottom: 1px solid #1e293b; }
        .table tr:hover td { background: rgba(129, 140, 248, 0.05); }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #64748b; }
        .empty-state h3 { color: #94a3b8; margin-bottom: 8px; }
        
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .badge-blue { background: rgba(129, 140, 248, 0.2); color: #a5b4fc; }
        .badge-green { background: rgba(52, 211, 153, 0.2); color: #6ee7b7; }
        .badge-yellow { background: rgba(251, 191, 36, 0.2); color: #fcd34d; }
        
        .cta-banner { background: linear-gradient(135deg, #4f46e5, #7c3aed); border-radius: 12px; padding: 24px; text-align: center; margin-top: 32px; }
        .cta-banner h3 { margin-bottom: 8px; }
        .cta-banner p { color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 16px; }
        .cta-btn { display: inline-block; background: white; color: #4f46e5; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; }
        .cta-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <nav class="nav">
        <a href="/" class="nav-logo">‚öñÔ∏è CaseVault</a>
        <div class="nav-links">
            <a href="casevault-calculator.html">Calculator</a>
            <a href="casevault-dashboard.html" class="active">Dashboard</a>
            <a href="casevault-contribute.html">Contribute</a>
            <a href="/">AIBridges</a>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>Settlement Dashboard</h1>
            <p>Real benchmark data from personal injury settlements across New England</p>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value" id="totalCases">--</div>
                <div class="stat-label">Total Settlements</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="medianValue">--</div>
                <div class="stat-label">Median Settlement</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stateCount">4</div>
                <div class="stat-label">States Covered</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="lastUpdate">--</div>
                <div class="stat-label">Last Updated</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <h3>Filter Data</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label>State</label>
                    <select id="filterState">
                        <option value="all">All States</option>
                        <option value="MA">Massachusetts</option>
                        <option value="CT">Connecticut</option>
                        <option value="RI">Rhode Island</option>
                        <option value="NH">New Hampshire</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Injury Type</label>
                    <select id="filterInjury">
                        <option value="all">All Injuries</option>
                        <option value="soft_tissue">Soft Tissue</option>
                        <option value="fracture">Fracture</option>
                        <option value="surgery_required">Surgery Required</option>
                        <option value="tbi">TBI</option>
                        <option value="spinal">Spinal</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Case Type</label>
                    <select id="filterCase">
                        <option value="all">All Cases</option>
                        <option value="rear_end">Rear-End</option>
                        <option value="t_bone">T-Bone</option>
                        <option value="truck">Truck</option>
                        <option value="motorcycle">Motorcycle</option>
                        <option value="pedestrian">Pedestrian</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <div class="grid">
                <!-- By State -->
                <div class="card">
                    <h3>Settlements by State</h3>
                    <div class="bar-chart" id="byStateChart"></div>
                </div>

                <!-- By Injury Type -->
                <div class="card">
                    <h3>Median by Injury Type</h3>
                    <div class="bar-chart" id="byInjuryChart"></div>
                </div>
            </div>

            <!-- State Breakdown Table -->
            <div class="card" style="margin-top: 24px;">
                <h3>State Breakdown</h3>
                <table class="table" id="stateTable">
                    <thead>
                        <tr>
                            <th>State</th>
                            <th>Cases</th>
                            <th>25th %ile</th>
                            <th>Median</th>
                            <th>75th %ile</th>
                        </tr>
                    </thead>
                    <tbody id="stateTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <h3>üìä Data Collection In Progress</h3>
            <p>We're actively collecting settlement data. Check back soon for benchmarks.</p>
            <a href="casevault-contribute.html" class="cta-btn" style="margin-top: 20px;">Contribute Data</a>
        </div>

        <!-- CTA -->
        <div class="cta-banner">
            <h3>Have Settlement Data to Share?</h3>
            <p>Contribute anonymized settlement data and help build the most comprehensive PI benchmark database in New England.</p>
            <a href="casevault-contribute.html" class="cta-btn">Contribute Data ‚Üí</a>
        </div>
    </div>

    <script>
        const DATA = window.CASEVAULT_DATA || null;

        function formatCurrency(num) {
            if (!num) return '--';
            if (num >= 1000000) return '$' + (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return '$' + Math.round(num / 1000) + 'K';
            return '$' + num.toLocaleString();
        }

        function renderBarChart(container, items, maxValue) {
            container.innerHTML = '';
            items.forEach(item => {
                const pct = maxValue > 0 ? (item.value / maxValue * 100) : 0;
                container.innerHTML += `
                    <div class="bar-item">
                        <div class="bar-label">${item.label}</div>
                        <div class="bar-track">
                            <div class="bar-fill" style="width: ${pct}%"></div>
                            <span class="bar-value">${item.display}</span>
                        </div>
                    </div>
                `;
            });
        }

        function renderDashboard(stateFilter = 'all', injuryFilter = 'all', caseFilter = 'all') {
            if (!DATA || DATA.totalSettlements === 0) {
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('totalCases').textContent = '0';
                document.getElementById('medianValue').textContent = '--';
                document.getElementById('lastUpdate').textContent = '--';
                return;
            }

            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';

            // Header stats
            document.getElementById('totalCases').textContent = DATA.totalSettlements.toLocaleString();
            
            // Calculate overall median from states with data
            const statesWithData = Object.values(DATA.states).filter(s => s.stats?.median);
            if (statesWithData.length > 0) {
                const avgMedian = statesWithData.reduce((sum, s) => sum + s.stats.median, 0) / statesWithData.length;
                document.getElementById('medianValue').textContent = formatCurrency(avgMedian);
            }
            
            if (DATA.lastUpdated) {
                const date = new Date(DATA.lastUpdated);
                document.getElementById('lastUpdate').textContent = date.toLocaleDateString();
            }

            // By State Chart
            const stateItems = [];
            let maxCases = 0;
            for (const [code, data] of Object.entries(DATA.states)) {
                if (stateFilter !== 'all' && code !== stateFilter) continue;
                const count = data.sampleSize || 0;
                if (count > maxCases) maxCases = count;
                stateItems.push({
                    label: code,
                    value: count,
                    display: count + ' cases'
                });
            }
            renderBarChart(document.getElementById('byStateChart'), stateItems, maxCases);

            // By Injury Chart
            const injuryItems = [];
            let maxMedian = 0;
            const injuries = ['soft_tissue', 'fracture', 'surgery_required', 'tbi', 'spinal'];
            const injuryLabels = { soft_tissue: 'Soft Tissue', fracture: 'Fracture', surgery_required: 'Surgery', tbi: 'TBI', spinal: 'Spinal' };
            
            for (const injury of injuries) {
                if (injuryFilter !== 'all' && injury !== injuryFilter) continue;
                
                let total = 0, count = 0;
                for (const [code, data] of Object.entries(DATA.states)) {
                    if (stateFilter !== 'all' && code !== stateFilter) continue;
                    if (data.byInjuryType?.[injury]?.typical) {
                        total += data.byInjuryType[injury].typical;
                        count++;
                    }
                }
                
                if (count > 0) {
                    const avg = total / count;
                    if (avg > maxMedian) maxMedian = avg;
                    injuryItems.push({
                        label: injuryLabels[injury] || injury,
                        value: avg,
                        display: formatCurrency(avg)
                    });
                }
            }
            renderBarChart(document.getElementById('byInjuryChart'), injuryItems, maxMedian);

            // State Table
            const tbody = document.getElementById('stateTableBody');
            tbody.innerHTML = '';
            for (const [code, data] of Object.entries(DATA.states)) {
                if (stateFilter !== 'all' && code !== stateFilter) continue;
                if (!data.sampleSize) continue;
                
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${code}</strong></td>
                        <td>${data.sampleSize}</td>
                        <td>${formatCurrency(data.stats?.p25)}</td>
                        <td><strong>${formatCurrency(data.stats?.median)}</strong></td>
                        <td>${formatCurrency(data.stats?.p75)}</td>
                    </tr>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderDashboard();

            // Filter handlers
            document.getElementById('filterState').addEventListener('change', function() {
                renderDashboard(this.value, document.getElementById('filterInjury').value, document.getElementById('filterCase').value);
            });
            document.getElementById('filterInjury').addEventListener('change', function() {
                renderDashboard(document.getElementById('filterState').value, this.value, document.getElementById('filterCase').value);
            });
            document.getElementById('filterCase').addEventListener('change', function() {
                renderDashboard(document.getElementById('filterState').value, document.getElementById('filterInjury').value, this.value);
            });
        });
    </script>
</body>
</html>
