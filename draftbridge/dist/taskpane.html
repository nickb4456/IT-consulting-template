<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DraftBridge</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 16px;
            font-size: 14px;
        }
        .header {
            font-size: 20px;
            font-weight: 700;
            color: #8B7355;
            margin-bottom: 16px;
        }
        .header span { color: #5C4A32; }
        .status {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
        }
        .status.error {
            background: #ffebee;
            color: #c62828;
        }
        .clause {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .clause-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 15px;
        }
        .clause-content {
            color: #555;
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 12px;
            max-height: 120px;
            overflow-y: auto;
            padding: 8px;
            background: #fafafa;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        .insert-btn {
            background: #8B7355;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            width: 100%;
            font-size: 14px;
        }
        .insert-btn:hover { background: #6d5a43; }
        .insert-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .insert-btn.success {
            background: #2e7d32;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">Draft<span>Bridge</span></div>
    <div id="status" class="status">Loading clauses...</div>
    <div id="clauses"></div>

    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script>
        const API = 'https://6b2bpmn8f8.execute-api.us-east-1.amazonaws.com/prod';
        const FIRM = 'morrison';

        Office.onReady(async (info) => {
            if (info.host === Office.HostType.Word) {
                loadClauses();
            } else {
                // For testing outside Word
                loadClauses();
            }
        });

        async function loadClauses() {
            const statusEl = document.getElementById('status');
            const clausesEl = document.getElementById('clauses');

            try {
                statusEl.textContent = 'Fetching clauses...';
                
                const response = await fetch(`${API}/firms/${FIRM}/clauses`);
                if (!response.ok) throw new Error('Failed to fetch');
                
                const allClauses = await response.json();
                
                // Take first 5 clauses
                const clauses = allClauses.slice(0, 5);
                
                statusEl.textContent = `✓ Loaded ${clauses.length} clauses. Click to insert.`;
                statusEl.classList.remove('error');

                clausesEl.innerHTML = clauses.map((clause, i) => `
                    <div class="clause">
                        <div class="clause-title">${escapeHtml(clause.title)}</div>
                        <div class="clause-content">${escapeHtml(clause.content)}</div>
                        <button class="insert-btn" onclick="insertClause(${i})">
                            Insert into Document
                        </button>
                    </div>
                `).join('');

                // Store clauses globally for insert function
                window.clauseData = clauses;

            } catch (err) {
                console.error('Load failed:', err);
                statusEl.textContent = '✗ Failed to load clauses: ' + err.message;
                statusEl.classList.add('error');
            }
        }

        async function insertClause(index) {
            const clause = window.clauseData[index];
            const btn = document.querySelectorAll('.insert-btn')[index];
            
            btn.disabled = true;
            btn.textContent = 'Inserting...';

            try {
                await Word.run(async (context) => {
                    const selection = context.document.getSelection();
                    selection.insertText(clause.content, Word.InsertLocation.replace);
                    await context.sync();
                });

                btn.textContent = '✓ Inserted!';
                btn.classList.add('success');
                
                setTimeout(() => {
                    btn.textContent = 'Insert into Document';
                    btn.classList.remove('success');
                    btn.disabled = false;
                }, 2000);

            } catch (err) {
                console.error('Insert failed:', err);
                btn.textContent = '✗ Failed - ' + err.message;
                
                setTimeout(() => {
                    btn.textContent = 'Insert into Document';
                    btn.disabled = false;
                }, 3000);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }
    </script>
</body>
</html>
