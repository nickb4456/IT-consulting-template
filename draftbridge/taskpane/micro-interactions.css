/**
 * DraftBridge - Micro-interactions & Feedback
 * 
 * Subtle, professional animations that provide clear feedback
 * without being distracting. Every interaction should feel responsive.
 * 
 * Design principles:
 * - Feedback should be immediate (<100ms for user actions)
 * - Animations should be subtle and professional
 * - Loading states should reduce perceived wait time
 * - Error states should help users recover
 * 
 * @version 1.0.0
 */

/* ============================================================================
   Timing Variables
   ============================================================================ */

:root {
    /* Timing tokens for consistency */
    --timing-instant: 50ms;
    --timing-fast: 100ms;
    --timing-normal: 150ms;
    --timing-slow: 250ms;
    --timing-spring: 300ms;
    
    /* Easing curves */
    --ease-out: cubic-bezier(0.33, 1, 0.68, 1);
    --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    
    /* Focus ring */
    --focus-ring: 0 0 0 3px var(--blue-subtle);
}

/* ============================================================================
   Button Micro-interactions
   ============================================================================ */

/* Enhanced button base transitions */
.btn {
    transition: 
        background var(--timing-fast) var(--ease-out),
        transform var(--timing-instant) var(--ease-out),
        box-shadow var(--timing-fast) var(--ease-out);
}

/* Press feedback - instant scale down */
.btn:active:not(:disabled) {
    transform: scale(0.97);
    transition-duration: var(--timing-instant);
}

/* Primary button hover glow */
.btn-primary:hover:not(:disabled) {
    box-shadow: 
        var(--shadow-md),
        0 0 16px var(--blue-subtle);
}

/* Primary button loading state */
.btn-primary.loading {
    position: relative;
    color: transparent;
    pointer-events: none;
}

.btn-primary.loading::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    top: 50%;
    left: 50%;
    margin: -8px 0 0 -8px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: btnSpinner 0.6s linear infinite;
}

@keyframes btnSpinner {
    to { transform: rotate(360deg); }
}

/* Button success state flash */
.btn.success {
    animation: btnSuccess 0.5s var(--ease-out);
}

@keyframes btnSuccess {
    0% { background: var(--blue); }
    50% { background: #059669; }
    100% { background: var(--blue); }
}

/* Back button hover enhancement */
.back-btn {
    transition: 
        border-color var(--timing-fast) var(--ease-out),
        color var(--timing-fast) var(--ease-out),
        transform var(--timing-fast) var(--ease-out);
}

.back-btn:hover {
    transform: translateX(-2px);
}

.back-btn:active {
    transform: translateX(-2px) scale(0.95);
}

/* ============================================================================
   Template Card Micro-interactions
   ============================================================================ */

.template-card {
    transition: 
        border-color var(--timing-normal) var(--ease-out),
        box-shadow var(--timing-normal) var(--ease-out),
        background-color var(--timing-normal) var(--ease-out),
        transform var(--timing-fast) var(--ease-out);
}

/* Hover - subtle lift and shift */
.template-card:hover {
    transform: translateX(4px);
}

/* Press - quick settle */
.template-card:active {
    transform: translateX(2px) scale(0.99);
    transition-duration: var(--timing-instant);
}

/* Icon scale on hover */
.template-icon {
    transition: 
        background-color var(--timing-normal) var(--ease-out),
        color var(--timing-normal) var(--ease-out),
        transform var(--timing-fast) var(--ease-spring);
}

.template-card:hover .template-icon {
    transform: scale(1.05);
}

/* Arrow slide-in effect */
.template-arrow {
    transition: 
        opacity var(--timing-fast) var(--ease-out),
        transform var(--timing-fast) var(--ease-out);
    transform: translateX(-4px);
}

.template-card:hover .template-arrow {
    opacity: 1;
    transform: translateX(0);
}

/* Loading state for template card */
.template-card.loading .template-icon {
    animation: iconPulse 1s ease-in-out infinite;
}

@keyframes iconPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.7; }
}

/* ============================================================================
   Field Input Micro-interactions
   ============================================================================ */

.field-input {
    transition: 
        border-color var(--timing-fast) var(--ease-out),
        background var(--timing-fast) var(--ease-out),
        box-shadow var(--timing-fast) var(--ease-out);
}

/* Focus - expand ring effect */
.field-input:focus {
    box-shadow: var(--focus-ring);
    animation: focusExpand 0.2s var(--ease-out);
}

@keyframes focusExpand {
    0% { box-shadow: 0 0 0 0 var(--blue-subtle); }
    100% { box-shadow: var(--focus-ring); }
}

/* Field group container - subtle highlight on focus-within */
.field-group {
    transition: transform var(--timing-fast) var(--ease-out);
    border-radius: var(--radius);
}

.field-group:focus-within {
    transform: translateY(-1px);
}

/* Empty field attention pulse */
.field-group.empty .field-input {
    animation: emptyPulse 2s ease-in-out 2;
}

@keyframes emptyPulse {
    0%, 100% { 
        border-color: #f59e0b;
        box-shadow: none;
    }
    50% { 
        border-color: #f59e0b;
        box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
    }
}

/* Field filled success flash */
.field-group.just-filled .field-input {
    animation: fieldFilled 0.5s var(--ease-out);
}

@keyframes fieldFilled {
    0% { background: var(--bg-subtle); }
    30% { background: rgba(5, 150, 105, 0.1); border-color: #059669; }
    100% { background: var(--bg-subtle); border-color: transparent; }
}

/* ============================================================================
   Toast Notifications
   ============================================================================ */

.toast {
    animation: toastEnter 0.3s var(--ease-spring);
}

@keyframes toastEnter {
    0% { 
        opacity: 0; 
        transform: translateY(16px) scale(0.95); 
    }
    100% { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

/* Toast exit */
.toast.exiting {
    animation: toastExit 0.2s var(--ease-out) forwards;
}

@keyframes toastExit {
    0% { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
    100% { 
        opacity: 0; 
        transform: translateY(-8px) scale(0.95); 
    }
}

/* Success toast - checkmark icon animation */
.toast.success::before {
    content: 'âœ“ ';
    display: inline-block;
    animation: checkBounce 0.4s var(--ease-spring) 0.1s both;
}

@keyframes checkBounce {
    0% { transform: scale(0); }
    60% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

/* Error toast - subtle shake */
.toast.error {
    animation: 
        toastEnter 0.3s var(--ease-spring),
        errorShake 0.4s ease 0.3s;
}

@keyframes errorShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    50% { transform: translateX(4px); }
    75% { transform: translateX(-2px); }
}

/* ============================================================================
   View Transitions
   ============================================================================ */

/* Fade in for views */
.view:not(.hidden) {
    animation: viewEnter 0.25s var(--ease-out);
}

@keyframes viewEnter {
    0% { 
        opacity: 0; 
        transform: translateY(8px); 
    }
    100% { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

/* Fields list stagger animation */
.fields-list .field-group {
    animation: fieldEnter 0.3s var(--ease-out) both;
}

.fields-list .field-group:nth-child(1) { animation-delay: 0ms; }
.fields-list .field-group:nth-child(2) { animation-delay: 50ms; }
.fields-list .field-group:nth-child(3) { animation-delay: 100ms; }
.fields-list .field-group:nth-child(4) { animation-delay: 150ms; }
.fields-list .field-group:nth-child(5) { animation-delay: 200ms; }
.fields-list .field-group:nth-child(6) { animation-delay: 250ms; }
.fields-list .field-group:nth-child(7) { animation-delay: 300ms; }
.fields-list .field-group:nth-child(8) { animation-delay: 350ms; }

@keyframes fieldEnter {
    0% { 
        opacity: 0; 
        transform: translateX(-10px); 
    }
    100% { 
        opacity: 1; 
        transform: translateX(0); 
    }
}

/* ============================================================================
   Fill All Progress Overlay
   ============================================================================ */

.fill-progress-overlay {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(4px);
    z-index: 100;
    animation: overlayFadeIn 0.15s var(--ease-out);
}

@media (prefers-color-scheme: dark) {
    .fill-progress-overlay {
        background: rgba(15, 23, 42, 0.9);
    }
}

@keyframes overlayFadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

.fill-progress-content {
    text-align: center;
    padding: 24px;
}

.fill-progress-text {
    font-size: 14px;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 16px;
}

.fill-progress-bar {
    width: 200px;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
}

.fill-progress-fill {
    height: 100%;
    background: var(--blue);
    border-radius: 2px;
    transition: width var(--timing-fast) var(--ease-out);
    position: relative;
}

/* Progress bar shimmer */
.fill-progress-fill::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.4) 50%,
        transparent 100%
    );
    animation: progressShimmer 1s ease-in-out infinite;
}

@keyframes progressShimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* ============================================================================
   Fill Complete Celebration
   ============================================================================ */

.fill-complete {
    text-align: center;
    animation: completeEnter 0.4s var(--ease-spring);
}

@keyframes completeEnter {
    0% { 
        opacity: 0; 
        transform: scale(0.8); 
    }
    100% { 
        opacity: 1; 
        transform: scale(1); 
    }
}

.fill-complete-icon {
    width: 48px;
    height: 48px;
    margin: 0 auto 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(5, 150, 105, 0.1);
    color: #059669;
    border-radius: 50%;
    animation: iconPop 0.5s var(--ease-spring);
}

@keyframes iconPop {
    0% { transform: scale(0); }
    60% { transform: scale(1.15); }
    100% { transform: scale(1); }
}

/* Checkmark draw animation */
.fill-complete-icon svg {
    width: 24px;
    height: 24px;
}

.fill-complete-icon svg polyline,
.fill-complete-icon svg path {
    stroke-dasharray: 50;
    stroke-dashoffset: 50;
    animation: drawCheck 0.4s ease 0.2s forwards;
}

@keyframes drawCheck {
    to { stroke-dashoffset: 0; }
}

.fill-complete-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 4px;
}

.fill-complete-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
}

/* Subtle confetti particles */
.fill-complete::before,
.fill-complete::after {
    content: '';
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    opacity: 0;
    animation: confetti 0.8s var(--ease-out) forwards;
}

.fill-complete::before {
    background: var(--blue);
    left: 35%;
    top: 40%;
    animation-delay: 0.1s;
}

.fill-complete::after {
    background: #059669;
    right: 35%;
    top: 40%;
    animation-delay: 0.2s;
}

@keyframes confetti {
    0% { 
        opacity: 1; 
        transform: translate(0, 0) scale(0); 
    }
    50% { 
        opacity: 1; 
        transform: translate(var(--x, 20px), -30px) scale(1); 
    }
    100% { 
        opacity: 0; 
        transform: translate(var(--x, 40px), -50px) scale(0.5); 
    }
}

/* ============================================================================
   Skeleton Loading
   ============================================================================ */

.skeleton {
    background: linear-gradient(
        90deg,
        var(--bg-subtle) 25%,
        var(--border) 50%,
        var(--bg-subtle) 75%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s ease-in-out infinite;
    border-radius: var(--radius);
}

@keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

.skeleton-field {
    height: 60px;
    margin-bottom: 16px;
}

.skeleton-btn {
    height: 44px;
}

/* ============================================================================
   Focus States (Accessibility)
   ============================================================================ */

/* Visible focus ring for all interactive elements */
.template-card:focus-visible,
.btn:focus-visible,
.back-btn:focus-visible,
.field-input:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring);
}

/* Skip link */
.skip-link {
    position: absolute;
    top: -100%;
    left: 16px;
    padding: 8px 16px;
    background: var(--blue);
    color: white;
    border-radius: var(--radius);
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    z-index: 1000;
    transition: top 0.2s ease;
}

.skip-link:focus {
    top: 8px;
}

/* ============================================================================
   Screen Reader Announcements
   ============================================================================ */

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* ============================================================================
   Reduced Motion
   ============================================================================ */

@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        animation-delay: 0ms !important;
    }
    
    /* Keep essential transforms but make them instant */
    .btn:active:not(:disabled) {
        transform: scale(0.97);
    }
    
    .template-card:hover {
        transform: translateX(2px);
    }
    
    /* Keep skip link functional */
    .skip-link:focus {
        transition: none;
    }
}
