<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Trends Dashboard | AIBridges</title>
    <style>
        :root {
            --bg: #0f0f0f;
            --card: #1a1a1a;
            --border: #2a2a2a;
            --text: #e5e5e5;
            --muted: #888;
            --accent: #ff0000;
            --green: #22c55e;
            --blue: #3b82f6;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff0000, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        header p { color: var(--muted); font-size: 1.1rem; }
        
        .quota-banner {
            background: linear-gradient(90deg, var(--card), var(--border));
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .quota-banner .quota-bar {
            flex: 1;
            min-width: 200px;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .quota-banner .quota-fill {
            height: 100%;
            background: var(--green);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .quota-banner .quota-fill.warning { background: #f59e0b; }
        .quota-banner .quota-fill.danger { background: var(--accent); }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent);
        }
        
        .stat-card .label { color: var(--muted); font-size: 0.85rem; }
        
        .section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .section h2 { margin-bottom: 20px; font-size: 1.4rem; }
        
        /* Actionable Insights */
        .insight-card {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
        }
        
        .insight-card .insight-title {
            font-weight: 600;
            color: var(--green);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .insight-card .insight-data {
            color: var(--text);
            margin-bottom: 10px;
        }
        
        .insight-card .insight-action {
            background: var(--green);
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            display: inline-block;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Hook Pattern Tiles - Compact & Expandable */
        .hooks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .hook-tile {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.08), rgba(255, 107, 107, 0.08));
            border: 1px solid rgba(255, 0, 0, 0.25);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.25s ease;
            position: relative;
        }
        
        .hook-tile:hover {
            border-color: rgba(255, 0, 0, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 0, 0, 0.15);
        }
        
        .hook-tile.expanded {
            grid-column: span 2;
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.12), rgba(255, 107, 107, 0.12));
        }
        
        @media (max-width: 600px) {
            .hook-tile.expanded { grid-column: span 1; }
        }
        
        .hook-tile .hook-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }
        
        .hook-tile .hook-name {
            font-weight: 600;
            color: var(--accent);
            font-size: 0.95rem;
            margin-bottom: 6px;
        }
        
        .hook-tile .hook-stats {
            font-size: 0.8rem;
            color: var(--muted);
        }
        
        .hook-tile .hook-views {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--text);
        }
        
        .hook-tile .hook-expand-icon {
            color: var(--muted);
            font-size: 0.8rem;
            transition: transform 0.2s;
        }
        
        .hook-tile.expanded .hook-expand-icon {
            transform: rotate(180deg);
        }
        
        .hook-tile .hook-details {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 0, 0, 0.2);
        }
        
        .hook-tile.expanded .hook-details {
            display: block;
        }
        
        .hook-tile .hook-example {
            font-size: 0.85rem;
            color: var(--muted);
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .hook-tile .hook-tip {
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 10px;
            border-radius: 6px;
            color: var(--text);
        }
        
        /* Pattern bars */
        .pattern-bars { display: flex; flex-direction: column; gap: 12px; }
        
        .pattern-bar {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .pattern-bar .name {
            width: 110px;
            font-weight: 500;
            text-transform: capitalize;
            font-size: 0.9rem;
        }
        
        .pattern-bar .bar-container {
            flex: 1;
            height: 28px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .pattern-bar .bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff6b6b);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 0.8rem;
            font-weight: bold;
            min-width: 90px;
        }
        
        /* Connections Section */
        .connections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .connection-card {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 15px;
        }
        
        .connection-card .conn-from,
        .connection-card .conn-to {
            font-size: 0.9rem;
            padding: 8px;
            background: var(--card);
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .connection-card .conn-arrow {
            text-align: center;
            color: var(--blue);
            font-weight: bold;
            padding: 5px;
        }
        
        .connection-card .conn-reason {
            font-size: 0.85rem;
            color: var(--muted);
            margin-top: 10px;
            font-style: italic;
        }
        
        /* Niche tabs */
        .niche-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .niche-tab {
            padding: 10px 20px;
            border: 2px solid var(--border);
            border-radius: 25px;
            background: transparent;
            color: var(--text);
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        
        .niche-tab:hover { border-color: var(--muted); }
        .niche-tab.active { border-color: var(--accent); background: rgba(255, 0, 0, 0.1); }
        
        /* Videos grid */
        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .video-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, border-color 0.2s;
        }
        
        .video-card:hover {
            transform: translateY(-3px);
            border-color: var(--muted);
        }
        
        .video-card a { text-decoration: none; color: inherit; }
        
        .video-card .thumb {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            background: var(--border);
        }
        
        .video-card .info { padding: 15px; }
        
        .video-card .title {
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .video-card .meta {
            display: flex;
            justify-content: space-between;
            color: var(--muted);
            font-size: 0.85rem;
        }
        
        .video-card .views { color: var(--accent); font-weight: 600; }
        
        .video-card .patterns {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .video-card .pattern-tag {
            background: var(--border);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--muted);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--muted);
        }
        
        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--muted);
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }
        
        footer a { color: var(--accent); }
        
        @media (max-width: 600px) {
            header h1 { font-size: 1.8rem; }
            .pattern-bar .name { width: 80px; font-size: 0.8rem; }
            .niche-tab { padding: 8px 15px; font-size: 0.85rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1>ðŸ“ˆ YouTube Trends Dashboard</h1>
        <p>Real data analysis of what's working on YouTube â€” updated daily</p>
        <p style="margin-top: 10px; font-size: 0.9rem;" id="lastUpdated">Loading...</p>
    </header>
    
    <div class="container">
        <div class="stats-row" id="statsRow">
            <div class="stat-card">
                <div class="value" id="totalVideos">-</div>
                <div class="label">Videos Analyzed</div>
            </div>
            <div class="stat-card">
                <div class="value" id="totalNiches">-</div>
                <div class="label">Niches Tracked</div>
            </div>
            <div class="stat-card">
                <div class="value" id="topPattern">-</div>
                <div class="label">Top Pattern</div>
            </div>
            <div class="stat-card">
                <div class="value" id="avgViews">-</div>
                <div class="label">Avg Views (Top 100)</div>
            </div>
        </div>
        
        <!-- Actionable Insights - Data-driven, not AI -->
        <div class="section">
            <h2>ðŸŽ¯ Actionable Insights (Based on Real Data)</h2>
            <div id="actionableInsights">
                <div class="loading">Calculating insights from data...</div>
            </div>
        </div>
        
        <!-- Hook Patterns -->
        <div class="section">
            <h2>ðŸŽ£ Opening Hook Patterns</h2>
            <p style="color: var(--muted); margin-bottom: 15px;">What successful videos use in their first lines</p>
            <div id="hookPatterns">
                <div class="loading">Analyzing hooks...</div>
            </div>
        </div>
        
        <!-- Common Talking Points -->
        <div class="section">
            <h2>ðŸ’¬ Common Talking Points</h2>
            <p style="color: var(--muted); margin-bottom: 15px;">Phrases and topics that appear in top-performing descriptions</p>
            <div id="talkingPoints">
                <div class="loading">Extracting talking points...</div>
            </div>
        </div>
        
        <!-- Pattern Performance -->
        <div class="section">
            <h2>ðŸ“Š Title Patterns That Work</h2>
            <div class="pattern-bars" id="patternBars">
                <div class="loading">Loading pattern data...</div>
            </div>
        </div>
        
        <!-- Video Connections -->
        <div class="section">
            <h2>ðŸ”— Content Connections</h2>
            <p style="color: var(--muted); margin-bottom: 15px;">Videos with similar successful patterns across niches</p>
            <div class="connections-grid" id="connectionsGrid">
                <div class="loading">Building connections...</div>
            </div>
        </div>
        
        <!-- Videos by Niche -->
        <div class="section">
            <h2>ðŸ”¥ Trending Videos by Niche</h2>
            <div class="niche-tabs" id="nicheTabs"></div>
            <div class="videos-grid" id="videosGrid">
                <div class="loading">Loading videos...</div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Data updated daily at 8 AM EST â€¢ Powered by <a href="https://aibridges.org">AIBridges</a></p>
        <p style="margin-top: 10px; font-size: 0.85rem;">YouTubeâ„¢ is a trademark of Google LLC</p>
    </footer>
    
    <script>
        let trendsData = null;
        let currentNiche = 'all';
        
        function formatViews(n) {
            if (n >= 1e6) return (n/1e6).toFixed(1) + 'M';
            if (n >= 1e3) return (n/1e3).toFixed(0) + 'K';
            return n.toString();
        }
        
        function formatDate(iso) {
            const d = new Date(iso);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }
        
        function escapeHtml(str) {
            return (str||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]);
        }
        
        function renderQuota() {
            const used = trendsData.quotaUsed || 0;
            const pct = Math.min(100, (used / 10000) * 100);
            document.getElementById('quotaUsed').textContent = used.toLocaleString();
            const fill = document.getElementById('quotaFill');
            fill.style.width = pct + '%';
            fill.className = 'quota-fill' + (pct > 80 ? ' danger' : pct > 50 ? ' warning' : '');
            document.getElementById('quotaStatus').textContent = pct < 50 ? 'âœ… Healthy' : pct < 80 ? 'âš ï¸ Moderate' : 'ðŸš¨ High';
        }
        
        function renderStats() {
            const niches = Object.values(trendsData.niches || {});
            const allVideos = niches.flatMap(n => n.videos || []);
            
            document.getElementById('totalVideos').textContent = allVideos.length;
            document.getElementById('totalNiches').textContent = niches.length;
            document.getElementById('topPattern').textContent = trendsData.patterns?.[0]?.name || '-';
            
            const avgViews = allVideos.length 
                ? Math.round(allVideos.reduce((s, v) => s + (v.views||0), 0) / allVideos.length)
                : 0;
            document.getElementById('avgViews').textContent = formatViews(avgViews);
            document.getElementById('lastUpdated').textContent = `Last updated: ${formatDate(trendsData.scrapedAt)}`;
        }
        
        function renderActionableInsights() {
            const container = document.getElementById('actionableInsights');
            const patterns = trendsData.patterns || [];
            const niches = Object.entries(trendsData.niches || {});
            const allVideos = niches.flatMap(([id, n]) => (n.videos || []).map(v => ({...v, niche: n.name})));
            
            const insights = [];
            
            // Insight 1: Best performing pattern with real numbers
            if (patterns.length > 0) {
                const top = patterns[0];
                const secondBest = patterns[1];
                const improvement = secondBest ? Math.round(((top.avgViews - secondBest.avgViews) / secondBest.avgViews) * 100) : 0;
                insights.push({
                    title: `"${top.name}" titles get ${formatViews(top.avgViews)} avg views`,
                    data: `This pattern outperforms "${secondBest?.name || 'others'}" by ${improvement}%. Found in ${top.count} of the top videos analyzed.`,
                    action: `Try: "${top.name === 'shorts' ? '#shorts' : top.name === 'question' ? 'Why/How/What...' : top.name === 'listicle' ? '10 Ways to...' : top.name === 'comparison' ? 'X vs Y' : top.name}" format in your next video`
                });
            }
            
            // Insight 2: Best niche right now
            const nichesByAvg = niches
                .map(([id, n]) => ({ id, name: n.name, avgViews: n.videos?.length ? n.videos.reduce((s,v) => s + (v.views||0), 0) / n.videos.length : 0 }))
                .sort((a, b) => b.avgViews - a.avgViews);
            
            if (nichesByAvg.length > 0) {
                const topNiche = nichesByAvg[0];
                insights.push({
                    title: `${topNiche.name} is the hottest niche right now`,
                    data: `Average ${formatViews(Math.round(topNiche.avgViews))} views in the last 14 days. ${nichesByAvg.length > 1 ? `That's ${Math.round(topNiche.avgViews / nichesByAvg[1].avgViews)}x more than ${nichesByAvg[1].name}.` : ''}`,
                    action: `Consider creating content in the ${topNiche.name} space`
                });
            }
            
            // Insight 3: Shorts vs long-form
            const shortsVideos = allVideos.filter(v => (v.patterns || []).includes('shorts'));
            const longVideos = allVideos.filter(v => !(v.patterns || []).includes('shorts'));
            if (shortsVideos.length > 0 && longVideos.length > 0) {
                const shortsAvg = shortsVideos.reduce((s,v) => s + (v.views||0), 0) / shortsVideos.length;
                const longAvg = longVideos.reduce((s,v) => s + (v.views||0), 0) / longVideos.length;
                const winner = shortsAvg > longAvg ? 'Shorts' : 'Long-form';
                const ratio = Math.round(Math.max(shortsAvg, longAvg) / Math.min(shortsAvg, longAvg));
                insights.push({
                    title: `${winner} content is winning right now (${ratio}x higher avg views)`,
                    data: `Shorts: ${formatViews(Math.round(shortsAvg))} avg | Long-form: ${formatViews(Math.round(longAvg))} avg. Based on ${shortsVideos.length} shorts and ${longVideos.length} long videos.`,
                    action: winner === 'Shorts' ? 'Prioritize short-form vertical content' : 'Invest in longer, in-depth videos'
                });
            }
            
            // Insight 4: Virality timing
            const recentVideos = allVideos.filter(v => v.virality > 0).sort((a,b) => b.virality - a.virality).slice(0, 5);
            if (recentVideos.length > 0) {
                const avgVirality = Math.round(recentVideos.reduce((s,v) => s + v.virality, 0) / recentVideos.length);
                insights.push({
                    title: `Top videos get ${formatViews(avgVirality)} views/day in first 2 weeks`,
                    data: `The fastest-growing video "${escapeHtml(recentVideos[0]?.title?.slice(0,40))}..." hit ${formatViews(recentVideos[0]?.views || 0)} views.`,
                    action: 'Optimize for first 48 hours: thumbnail, title, and initial engagement'
                });
            }
            
            container.innerHTML = insights.map(i => `
                <div class="insight-card">
                    <div class="insight-title">ðŸ’¡ ${escapeHtml(i.title)}</div>
                    <div class="insight-data">${escapeHtml(i.data)}</div>
                    <div class="insight-action">â†’ ${escapeHtml(i.action)}</div>
                </div>
            `).join('') || '<p style="color: var(--muted)">Not enough data yet</p>';
        }
        
        function renderPatterns() {
            const container = document.getElementById('patternBars');
            const patterns = trendsData.patterns || [];
            if (!patterns.length) {
                container.innerHTML = '<p style="color: var(--muted)">No pattern data</p>';
                return;
            }
            
            const maxViews = patterns[0]?.avgViews || 1;
            
            container.innerHTML = patterns.slice(0, 8).map(p => `
                <div class="pattern-bar">
                    <span class="name">${escapeHtml(p.name)}</span>
                    <div class="bar-container">
                        <div class="bar" style="width: ${Math.max(10, (p.avgViews / maxViews) * 100)}%">
                            ${formatViews(p.avgViews)} avg Â· ${p.count} videos
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderHookPatterns() {
            const container = document.getElementById('hookPatterns');
            const niches = Object.values(trendsData.niches || {});
            const allVideos = niches.flatMap(n => n.videos || []);
            
            // Analyze title hooks (first part of title)
            const hookTypes = {
                'Comparison': { pattern: /(vs\.?|versus|compared|better than|or )/i, tip: 'Try: "X vs Y - Which is Better?"', icon: 'âš”ï¸' },
                'Challenge': { pattern: /(challenge|impossible|bet you|try this|can you)/i, tip: 'Try: "I Tried X for 30 Days"', icon: 'ðŸ†' },
                'Story': { pattern: /^(i |my |we |this is how|the story|what happened)/i, tip: 'Try: "I Finally Did X..." or "My Journey to..."', icon: 'ðŸ“–' },
                'Curiosity Gap': { pattern: /(secret|truth|nobody|don't want you|won't believe|shocking)/i, tip: 'Try: "The Truth About X" or "What They Don\'t Tell You"', icon: 'ðŸ¤«' },
                'Question': { pattern: /^(why|what|how|is|are|can|do|does|should|would|will|did)/i, tip: 'Try: "Why Does X Happen?" or "What If..."', icon: 'â“' },
                'Listicle': { pattern: /^(\d+|top \d+|the \d+)/i, tip: 'Try: "10 Ways to..." or "5 Things You Need"', icon: 'ðŸ“‹' },
                'How-To': { pattern: /^(how to|how i|the way to|step by step)/i, tip: 'Try: "How to X in 5 Minutes"', icon: 'ðŸŽ“' },
                'Urgency': { pattern: /(now|today|2025|2026|new|just|finally|breaking)/i, tip: 'Try: "NEW 2026..." or "This Changes Everything"', icon: 'âš¡' },
            };
            
            // Count matches
            Object.keys(hookTypes).forEach(name => {
                hookTypes[name].count = 0;
                hookTypes[name].avgViews = 0;
                hookTypes[name].examples = [];
            });
            
            allVideos.forEach(v => {
                const title = (v.title || '').toLowerCase();
                Object.entries(hookTypes).forEach(([name, data]) => {
                    if (data.pattern.test(title)) {
                        data.count++;
                        data.avgViews += v.views || 0;
                        if (data.examples.length < 2) {
                            data.examples.push({ title: v.title, views: v.views });
                        }
                    }
                });
            });
            
            // Calculate averages and sort
            const hooks = Object.entries(hookTypes)
                .map(([name, data]) => ({
                    name,
                    count: data.count,
                    avgViews: data.count > 0 ? Math.round(data.avgViews / data.count) : 0,
                    examples: data.examples,
                    tip: data.tip,
                    icon: data.icon,
                }))
                .filter(h => h.count > 0)
                .sort((a, b) => b.avgViews - a.avgViews);
            
            if (!hooks.length) {
                container.innerHTML = '<p style="color: var(--muted)">Not enough data</p>';
                return;
            }
            
            container.innerHTML = `<div class="hooks-grid">${hooks.map((h, i) => `
                <div class="hook-tile" data-hook="${i}" onclick="toggleHook(this)">
                    <div class="hook-header">
                        <div>
                            <div class="hook-name">${h.icon} ${escapeHtml(h.name)}</div>
                            <div class="hook-views">${formatViews(h.avgViews)}</div>
                            <div class="hook-stats">${h.count} videos</div>
                        </div>
                        <span class="hook-expand-icon">â–¼</span>
                    </div>
                    <div class="hook-details">
                        ${h.examples.length ? `
                            <div class="hook-example">
                                "${escapeHtml(h.examples[0].title.slice(0, 55))}..."
                            </div>
                        ` : ''}
                        <div class="hook-tip">ðŸ’¡ ${escapeHtml(h.tip)}</div>
                    </div>
                </div>
            `).join('')}</div>`;
        }
        
        function toggleHook(el) {
            el.classList.toggle('expanded');
        }
        
        function renderTalkingPoints() {
            const container = document.getElementById('talkingPoints');
            const niches = Object.values(trendsData.niches || {});
            const allVideos = niches.flatMap(n => n.videos || []);
            
            // Extract common words/phrases from descriptions
            const wordCounts = {};
            const stopWords = new Set(['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may', 'might', 'must', 'shall', 'can', 'this', 'that', 'these', 'those', 'i', 'you', 'we', 'they', 'he', 'she', 'it', 'my', 'your', 'our', 'their', 'his', 'her', 'its', 'more', 'most', 'some', 'any', 'no', 'not', 'only', 'same', 'so', 'than', 'too', 'very', 'just', 'also', 'now', 'here', 'there', 'when', 'where', 'why', 'how', 'all', 'each', 'every', 'both', 'few', 'from', 'into', 'out', 'up', 'down', 'about', 'after', 'before', 'over', 'under', 'again', 'further', 'then', 'once']);
            
            allVideos.forEach(v => {
                const text = ((v.title || '') + ' ' + (v.description || '')).toLowerCase();
                const words = text.match(/\b[a-z]{4,}\b/g) || [];
                words.forEach(word => {
                    if (!stopWords.has(word)) {
                        if (!wordCounts[word]) wordCounts[word] = { count: 0, totalViews: 0 };
                        wordCounts[word].count++;
                        wordCounts[word].totalViews += v.views || 0;
                    }
                });
            });
            
            // Get top topics by frequency and views
            const topics = Object.entries(wordCounts)
                .map(([word, data]) => ({
                    word,
                    count: data.count,
                    avgViews: Math.round(data.totalViews / data.count),
                }))
                .filter(t => t.count >= 3) // At least 3 occurrences
                .sort((a, b) => b.avgViews - a.avgViews)
                .slice(0, 15);
            
            if (!topics.length) {
                container.innerHTML = '<p style="color: var(--muted)">Not enough data</p>';
                return;
            }
            
            container.innerHTML = `
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    ${topics.map(t => `
                        <span style="
                            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(99, 102, 241, 0.2));
                            border: 1px solid rgba(59, 130, 246, 0.3);
                            padding: 8px 16px;
                            border-radius: 20px;
                            font-size: 0.9rem;
                        ">
                            <strong>${escapeHtml(t.word)}</strong>
                            <span style="color: var(--muted); margin-left: 5px;">${t.count}Ã— Â· ${formatViews(t.avgViews)} avg</span>
                        </span>
                    `).join('')}
                </div>
            `;
        }
        
        function renderConnections() {
            const container = document.getElementById('connectionsGrid');
            const niches = Object.entries(trendsData.niches || {});
            const allVideos = niches.flatMap(([id, n]) => (n.videos || []).map(v => ({...v, niche: n.name, nicheId: id})));
            
            // Find videos with similar patterns across different niches
            const connections = [];
            const patternGroups = {};
            
            allVideos.forEach(v => {
                (v.patterns || []).forEach(p => {
                    if (!patternGroups[p]) patternGroups[p] = [];
                    patternGroups[p].push(v);
                });
            });
            
            Object.entries(patternGroups).forEach(([pattern, videos]) => {
                // Find pairs from different niches
                for (let i = 0; i < videos.length && connections.length < 6; i++) {
                    for (let j = i + 1; j < videos.length && connections.length < 6; j++) {
                        if (videos[i].nicheId !== videos[j].nicheId) {
                            connections.push({
                                v1: videos[i],
                                v2: videos[j],
                                pattern,
                                combinedViews: (videos[i].views || 0) + (videos[j].views || 0)
                            });
                        }
                    }
                }
            });
            
            // Sort by combined views and take top
            connections.sort((a, b) => b.combinedViews - a.combinedViews);
            
            if (!connections.length) {
                container.innerHTML = '<p style="color: var(--muted)">Not enough cross-niche patterns yet</p>';
                return;
            }
            
            container.innerHTML = connections.slice(0, 6).map(c => `
                <div class="connection-card">
                    <div class="conn-from">
                        <strong>${escapeHtml(c.v1.niche)}</strong><br>
                        ${escapeHtml((c.v1.title || '').slice(0, 50))}...
                        <br><small style="color: var(--accent)">${formatViews(c.v1.views || 0)} views</small>
                    </div>
                    <div class="conn-arrow">â†• Same "${c.pattern}" pattern</div>
                    <div class="conn-to">
                        <strong>${escapeHtml(c.v2.niche)}</strong><br>
                        ${escapeHtml((c.v2.title || '').slice(0, 50))}...
                        <br><small style="color: var(--accent)">${formatViews(c.v2.views || 0)} views</small>
                    </div>
                    <div class="conn-reason">ðŸ’¡ This "${c.pattern}" format works across ${escapeHtml(c.v1.niche)} and ${escapeHtml(c.v2.niche)}</div>
                </div>
            `).join('');
        }
        
        function renderNicheTabs() {
            const container = document.getElementById('nicheTabs');
            const niches = Object.entries(trendsData.niches || {});
            
            let html = `<button class="niche-tab ${currentNiche === 'all' ? 'active' : ''}" data-niche="all">All Niches</button>`;
            niches.forEach(([id, niche]) => {
                html += `<button class="niche-tab ${currentNiche === id ? 'active' : ''}" data-niche="${id}">${escapeHtml(niche.name)}</button>`;
            });
            
            container.innerHTML = html;
            container.querySelectorAll('.niche-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentNiche = btn.dataset.niche;
                    renderNicheTabs();
                    renderVideos();
                });
            });
        }
        
        function renderVideos() {
            const container = document.getElementById('videosGrid');
            let videos = [];
            
            if (currentNiche === 'all') {
                videos = Object.values(trendsData.niches || {})
                    .flatMap(n => (n.videos || []).slice(0, 4))
                    .sort((a, b) => (b.virality || 0) - (a.virality || 0));
            } else {
                videos = trendsData.niches?.[currentNiche]?.videos || [];
            }
            
            if (!videos.length) {
                container.innerHTML = '<p style="color: var(--muted); padding: 40px;">No videos found</p>';
                return;
            }
            
            container.innerHTML = videos.slice(0, 20).map(v => `
                <div class="video-card">
                    <a href="https://youtube.com/watch?v=${v.videoId}" target="_blank" rel="noopener">
                        <img class="thumb" src="${v.thumbnail || `https://i.ytimg.com/vi/${v.videoId}/hqdefault.jpg`}" alt="" loading="lazy">
                        <div class="info">
                            <div class="title">${escapeHtml(v.title)}</div>
                            <div class="meta">
                                <span>${escapeHtml(v.channelName)}</span>
                                <span class="views">${formatViews(v.views || 0)} views</span>
                            </div>
                            ${(v.patterns || []).length ? `
                                <div class="patterns">
                                    ${v.patterns.map(p => `<span class="pattern-tag">${escapeHtml(p)}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </a>
                </div>
            `).join('');
        }
        
        async function loadData() {
            try {
                const res = await fetch('youtube-trends-data.json');
                if (!res.ok) throw new Error('Data not found');
                trendsData = await res.json();
                
                renderStats();
                renderActionableInsights();
                renderHookPatterns();
                renderTalkingPoints();
                renderPatterns();
                renderConnections();
                renderNicheTabs();
                renderVideos();
            } catch (err) {
                console.error('Failed to load trends data:', err);
                document.querySelectorAll('.loading').forEach(el => {
                    el.innerHTML = 'Unable to load data. Please check back later.';
                });
            }
        }
        
        loadData();
    </script>
<script src="/ouroboros/nav.js"></script>
</body>
</html>
